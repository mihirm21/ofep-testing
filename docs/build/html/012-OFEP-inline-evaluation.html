<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>012-OFEP-Inline Evaluation of Flag Rules &mdash; OFEP-TESTING 1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="006-OFEP-flagd-sockets" href="006-OFEP-flagd-sockets.html" />
    <link rel="prev" title="009-OFEP-Add dispose functionality to API" href="009-OFEP-add-dispose.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            OFEP-TESTING
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">OFEP Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="016-OFEP-provider-metadata-capability-discovery.html">016-OFEP-provider-metadata-capability-discovery</a></li>
<li class="toctree-l1"><a class="reference internal" href="015-OFEP-provider-client-mapping.html">015-OFEP-Provider to client mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="017-OFEP-single-context-paradigm.html">017-OFEP-single-context-paradigm</a></li>
<li class="toctree-l1"><a class="reference internal" href="014-OFEP-ofo-flagd-client-support.html">014-OFEP-flagd client support driven by OpenFeature Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="001-OFEP-cloud-native-pattern.html">001-OFEP-cloud-native-pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="007-OFEP-flag-change-events.html">007-OFEP-flag-change-events</a></li>
<li class="toctree-l1"><a class="reference internal" href="004-OFEP-kubernetes-sync-service.html">004-OFEP-inotfiy-interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="003-OFEP-CUE-upstream.html">003-OFEP-CUE-upstream</a></li>
<li class="toctree-l1"><a class="reference internal" href="009-OFEP-add-dispose.html">009-OFEP-Add dispose functionality to API</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">012-OFEP-Inline Evaluation of Flag Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="006-OFEP-flagd-sockets.html">006-OFEP-flagd-sockets</a></li>
<li class="toctree-l1"><a class="reference internal" href="011-OFEP-transaction-context-propagation.html">011-OFEP-Transaction Context Propagation</a></li>
<li class="toctree-l1"><a class="reference internal" href="005-OFEP-provider-hook.html">005-OFEP-provider-hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="000-OFEP-template.html">NAME</a></li>
<li class="toctree-l1"><a class="reference internal" href="002-OFEP-kubecon-demo.html">002-OFEP-kubecon-demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="013-OFEP-ofo-flag-service.html">013-OFEP-flag service deployment driven by OpenFeature Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="008-OFEP-provider-flag-metadata.html">008-OFEP-Surfacing flag metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="OFEP_Index.html">OFEP Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="010-OFEP-flagd-grpc-sync.html">010-OFEP-Add gRPC sync support to flagd</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OFEP-TESTING</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">012-OFEP-Inline Evaluation of Flag Rules</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/012-OFEP-inline-evaluation.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ofep-inline-evaluation-of-flag-rules">
<h1>012-OFEP-Inline Evaluation of Flag Rules<a class="headerlink" href="#ofep-inline-evaluation-of-flag-rules" title="Permalink to this heading"></a></h1>
<section id="state-rejected">
<h2>State: REJECTED<a class="headerlink" href="#state-rejected" title="Permalink to this heading"></a></h2>
<p>This OFEP seeks to find a solution for near-zero latency flag evaluation for server-side contexts (e.g. not mobile or client-side web).</p>
</section>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading"></a></h2>
<p>Today, most flag providers make API calls to backing services to understand if a given flag should return e.g. <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>. Even if that API call is going to a kubernetes sidecar like the flagD case, it introduces latency which may not be acceptable in high scale use-cases. The flag’s rules are often evaluated on another service because determining whether the provided context matches a given set of rules requires computation which may be non-trivial or may take into account data not known by the caller.</p>
</section>
<section id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this heading"></a></h2>
<p>To address this, I’d like to define a mechanism by which the rules can be returned to the openfeature client, and it can determine the answer of which value to return. The intent is to update these rules outside of the scope of the request lifecycle, such as at startup and/or on an interval basis.</p>
</section>
<section id="updated-provider-api">
<h2>Updated Provider API<a class="headerlink" href="#updated-provider-api" title="Permalink to this heading"></a></h2>
<p>We would offer a stock <code class="docutils literal notranslate"><span class="pre">RuleEvaluatingProvider</span></code> that would implement the <code class="docutils literal notranslate"><span class="pre">getBooleanEvaluation</span></code> et al methods given a rule state. That rule state would be fetched by a <code class="docutils literal notranslate"><span class="pre">RuleFetcher</span></code>, which provider authors would implement. That fetcher would, for instance, download the rules from the data store and set up an appropriate update interval in the background.</p>
<p>When “provider ready” events are in use, <code class="docutils literal notranslate"><span class="pre">RuleEvaluatingProvider</span></code> will not emit ready until the <code class="docutils literal notranslate"><span class="pre">RuleFetcher</span></code> emits ready.</p>
</section>
<section id="rule-format">
<h2>Rule Format<a class="headerlink" href="#rule-format" title="Permalink to this heading"></a></h2>
<p>The rule format use <a class="reference external" href="https://jsonlogic.com/">JsonLogic</a>, which is already setup in <code class="docutils literal notranslate"><span class="pre">flagD</span></code> and has broad support for various languages.</p>
<section id="what-it-might-look-like">
<h3>What it might look like<a class="headerlink" href="#what-it-might-look-like" title="Permalink to this heading"></a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyRulesProvider</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RuleFetcher</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">JsonLogic</span><span class="w"> </span><span class="nf">fetch</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// your code to get the flags and their rules and convert it to jsonlogic goes here</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// in your app setup code..</span>
<span class="n">OpenFeature</span><span class="p">.</span><span class="na">getInstance</span><span class="p">().</span><span class="na">setProvider</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">RuleEvaluatingProvider</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">MyRulesProvider</span><span class="p">(</span><span class="n">API_KEY</span><span class="p">)))</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="009-OFEP-add-dispose.html" class="btn btn-neutral float-left" title="009-OFEP-Add dispose functionality to API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="006-OFEP-flagd-sockets.html" class="btn btn-neutral float-right" title="006-OFEP-flagd-sockets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mihir Mittal.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>